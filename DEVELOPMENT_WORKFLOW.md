# 開發流程管控文件

## 🔒 **功能鎖定原則**

### **核心原則**
- **已完成並測試通過的功能模組，除非明確指令，否則禁止修改**
- **每個功能模組獨立開發，避免交叉影響**
- **新功能開發不得影響已鎖定的功能**

## 📊 **功能狀態追蹤**

### **🔒 已鎖定功能 (禁止修改)**

#### **1. 語音轉錄功能** ✅ **已鎖定** (2025-08-18)
**涵蓋範圍：**
- 語音轉錄頁籤的所有UI元件
- 轉錄核心邏輯 (`transcription_manager.py`)
- 檔案選擇和模型設定 (Medium、Large-v2)
- 進度顯示和日誌系統
- 輸出格式處理
- 繁體中文轉換功能
- WAV檔案格式轉換和處理
- 即時轉錄進度顯示

**鎖定的程式碼區域：**
- `gui_main.py` 中的 `create_transcribe_tab()` 方法
- `gui_main.py` 中的 `transcribe_audio()` 方法
- `gui_main.py` 中的 `_handle_transcription_result()` 方法
- `gui_main.py` 中的 `_convert_to_wav_for_transcription()` 方法
- `gui_main.py` 中的 `_convert_srt_to_traditional_chinese()` 方法
- 語音轉錄相關的UI元件和事件處理
- 模型選擇和參數處理邏輯

**測試狀態：** ✅ 完整測試通過，問題已修復
**最後修改：** 2025-08-18
**鎖定原因：** 緊急修復完成，移除問題模型，功能穩定可靠

#### **2. AI校正功能** ✅ **已鎖定** (2025-07-26)
**涵蓋範圍：**
- AI校正按鈕和相關UI
- 分批處理機制
- 重試機制和錯誤處理
- 專業提示詞工程
- 預覽編輯視窗
- 檔案儲存邏輯

**鎖定的程式碼區域：**
- `gui_main.py` 中的 `ai_correct_srt()` 方法
- `gui_main.py` 中的 `_do_ai_correction_thread()` 方法
- `gui_main.py` 中的 `show_correction_preview()` 方法
- AI校正相關的所有UI元件

**測試狀態：** ✅ 完整測試通過
**最後修改：** 2025-07-26
**鎖定原因：** 分批處理、重試機制、預覽編輯功能完整

#### **3. AI分析功能** ✅ **已鎖定** (2025-07-26)
**涵蓋範圍：**
- AI分析按鈕和相關UI
- 結構化分析邏輯
- 摘要、修正建議、關鍵詞提取
- 分析結果展示視窗
- 提示詞更新功能

**鎖定的程式碼區域：**
- `gui_main.py` 中的 `ai_analyze_srt()` 方法
- `gui_main.py` 中的 `_do_ai_analysis_thread()` 方法
- `gui_main.py` 中的 `show_analysis_popup()` 方法
- `gui_main.py` 中的 `update_prompt_from_analysis()` 方法

**測試狀態：** ✅ 完整測試通過
**最後修改：** 2025-07-26
**鎖定原因：** 分析品質高，結果展示完整

#### **4. AI翻譯功能** ✅ **已鎖定** (2025-07-27)
**涵蓋範圍：**
- AI設定區域的翻譯語言下拉選單
- 分批翻譯處理機制 (使用設定中的批次大小)
- 重試機制和錯誤處理
- 翻譯預覽視窗 (顏色標記翻譯狀態)
- 時間戳檔案命名和儲存邏輯

**鎖定的程式碼區域：**
- `gui_main.py` 中的 `ai_translate_srt_placeholder()` 方法
- `gui_main.py` 中的 `_do_ai_translation_thread()` 方法  
- `gui_main.py` 中的 `_show_translation_preview()` 方法
- AI設定區域的翻譯語言下拉選單 (`translation_language_var`, `translation_language_combo`)
- AI翻譯相關的狀態管理和UI更新 (`is_ai_translating`, `update_ai_buttons_state_tab`)

**測試狀態：** ✅ 完整測試通過
**最後修改：** 2025-07-27
**鎖定原因：** 功能完整且穩定，UI體驗優化，與設定系統完美整合

#### **5. AI新聞報導生成功能** ✅ **已鎖定** (2025-07-27)
**涵蓋範圍：**
- AI新聞報導生成按鈕和相關UI (按鈕文字統一為"AI 新聞")
- 專業新聞報導提示詞工程 (溫度0.7，創意性設定)
- 標題和內容結構化解析
- 可編輯的新聞報導預覽視窗
- 時間戳檔案命名和儲存邏輯

**鎖定的程式碼區域：**
- `gui_main.py` 中的 `ai_generate_news_report()` 方法
- `gui_main.py` 中的 `_do_ai_news_generation_thread()` 方法
- `gui_main.py` 中的 `_show_news_report_preview()` 方法
- 新聞報導按鈕 (`ai_news_button_tab`)
- 新聞報導狀態管理 (`is_ai_generating_news`)

**測試狀態：** ✅ 完整測試通過
**最後修改：** 2025-07-27
**鎖定原因：** 功能完整且穩定，UI一致性優化，與OkokGo核心邏輯完全相同

#### **6. 社群媒體建議功能** ✅ **已鎖定** (2025-07-27)
**涵蓋範圍：**
- AI社群媒體建議按鈕和相關UI (按鈕文字統一為"AI 社群")
- **改進版一次調用方法** (從5次API調用優化為1次，大幅提升效率)
- **JSON結構化輸出** (主要解析+備用解析，確保可靠性)
- **高品質專業提示詞** (參考OkokGo方法，強調商業價值和實用性)
- **台灣市場本地化** (考慮台灣市場特色和用戶習慣)
- 多平台優化的提示詞工程 (溫度0.8，高創意性設定)
- 結構化內容解析 (YouTube、Podcast、SEO、封面、分析)
- 分頁式預覽視窗 (使用Notebook頁籤展示不同平台建議)
- 時間戳檔案命名和儲存邏輯

**鎖定的程式碼區域：**
- `gui_main.py` 中的 `ai_generate_social_media()` 方法
- `gui_main.py` 中的 `_do_ai_social_media_thread()` 方法
- `gui_main.py` 中的 `_show_social_media_preview()` 方法
- 社群媒體按鈕 (`ai_social_button_tab`)
- 社群媒體狀態管理 (`is_ai_generating_social`)

**測試狀態：** ✅ 完整測試通過
**最後修改：** 2025-07-27
**鎖定原因：** 功能完整且穩定，採用改進版一次調用方法，效率和品質顯著提升，與OkokGo核心邏輯完全相同

#### **7. 語音轉錄頁籤** ✅ **已鎖定** (2025-07-27)
**涵蓋範圍：**
- 語音轉錄頁籤的完整UI和所有功能
- 所有轉錄相關的使用者介面元件
- 檔案選擇、模型設定、進度顯示
- 轉錄結果處理和儲存邏輯

**鎖定的程式碼區域：**
- `gui_main.py` 中的 `create_transcribe_tab()` 完整方法
- 語音轉錄頁籤的所有UI元件和事件處理
- 轉錄相關的所有變數和狀態管理

**測試狀態：** ✅ 完整測試通過
**最後修改：** 2025-07-27
**鎖定原因：** 頁籤功能完整且穩定，嚴禁修改

#### **8. AI功能頁籤** ✅ **已鎖定** (2025-07-27)
**涵蓋範圍：**
- AI功能頁籤的完整UI和所有功能
- 所有AI功能按鈕和相關介面元件
- AI設定區域和狀態顯示
- 所有已鎖定的AI功能整合

**鎖定的程式碼區域：**
- `gui_main.py` 中的 `create_ai_tab()` 完整方法
- AI功能頁籤的所有UI元件和事件處理
- AI功能相關的所有變數和狀態管理
- AI功能按鈕排版和佈局

**測試狀態：** ✅ 完整測試通過
**最後修改：** 2025-07-27
**鎖定原因：** 頁籤功能完整且穩定，按鈕排版已優化，嚴禁修改

### **📋 待開發功能**

#### **11. AI影片頁籤功能** ✅ **已完成** - **獨立頁籤實作** (2025-08-23)
**涵蓋範圍：**
- 創建獨立的AI影片生成頁籤
- 基於OkokGo VideoGenerationSection.tsx架構
- 支援多種影片風格和進階配置
- 專業影片提示詞工程
- 為未來Veo API整合預留接口

**已完成功能：**
- ✅ **獨立AI影片頁籤** - 完整的🎬 AI影片頁籤
- ✅ **完整設定介面** - 3x4網格佈局，包含所有VideoGenerationSection.tsx的設定
- ✅ **檔案載入功能** - 支援逐字稿檔案和起始圖片選擇
- ✅ **影片提示生成** - 基於逐字稿的AI影片提示詞生成
- ✅ **6層結構化提示詞** - 專業的影片提示詞工程架構
- ✅ **多種配置支援** - 10種風格、3種比例、4種時長、3種人物生成策略
- ✅ **SRT智能解析** - 自動解析SRT格式並選擇關鍵條目
- ✅ **提示詞管理** - 編輯、刪除、複製功能
- ✅ **影片生成框架** - 完整的生成流程和結果顯示
- ✅ **狀態管理** - 完善的按鈕狀態和進度顯示
**測試狀態：** ✅ 基礎功能完成，提示詞生成可用
**開發進度：** 95% 完成，僅Veo API整合待實作

#### **10. AI創意頁籤** ✅ **已鎖定** (2025-08-06)
**涵蓋範圍：**
- AI創意頁籤的完整UI和基礎架構
- 圖像提示生成功能完整整合
- 獨立的UI設計和功能架構
- 為未來創意AI功能預留擴展空間

**鎖定的程式碼區域：**
- `gui_main.py` 中的 `create_creative_tab()` 完整方法
- AI創意頁籤的所有UI元件和事件處理
- 圖像生成相關的所有變數和狀態管理
- 創意功能按鈕排版和佈局

**測試狀態：** ✅ 完整測試通過
**最後修改：** 2025-08-06
**鎖定原因：** 頁籤功能完整且穩定，圖像生成功能已完美整合

#### **9. 圖像提示生成功能** ✅ **已鎖定** (2025-08-06)
**涵蓋範圍：**
- 在AI創意頁籤中實作圖像提示生成
- 基於OkokGo ImageGenerationSection.tsx架構
- 支援10種藝術風格選擇（寫實、動漫、油畫等）
- 專業6層結構化提示詞工程
- JSON Schema強制輸出確保結構一致性
- 台灣本土化場景和人物描述
- **即時顯示功能** - 生成一張顯示一張
- **4張一排網格佈局** - 優化視覺呈現
- **一鍵下載功能** - 批量下載所有圖片
- **單張下載按鈕** - 每張圖片獨立下載
- **智能UI管理** - 按鈕狀態和統計即時更新
- 完整的設定視窗和結果展示
- 支援JSON和TXT格式儲存

**鎖定的程式碼區域：**
- `gui_main.py` 中的 `generate_image_prompts()` 方法
- `gui_main.py` 中的 `_generate_image_prompts_thread()` 方法
- `gui_main.py` 中的 `generate_images_from_prompts()` 方法
- `gui_main.py` 中的 `_generate_images_from_prompts_thread()` 方法
- `gui_main.py` 中的 `init_image_results_display()` 方法
- `gui_main.py` 中的 `add_single_image_result()` 方法
- `gui_main.py` 中的 `download_all_generated_images()` 方法
- `gui_main.py` 中的 `download_generated_image()` 方法
- `gui_main.py` 中的 `create_image_preview()` 方法
- `gui_main.py` 中的 `update_image_prompts_display()` 方法
- `gui_main.py` 中的 `save_image_prompts_json()` 和 `save_image_prompts_txt()` 方法
- AI創意頁籤中的圖像生成相關UI元件

**測試狀態：** ✅ 完整測試通過
**最後修改：** 2025-08-06
**鎖定原因：** 功能完整且穩定，即時顯示、網格佈局、下載功能均已優化，UI體驗良好

### **⏸️ 暫停開發功能**
#### **報導原則檢查功能** - **暫停開發** (2025-07-27)
**暫停原因：** 法規內容完整性待確認，需要完整的官方自殺防治報導原則後再實作
**狀態：** 已移除相關程式碼，等待完整法規內容確認後重新開發

### **❌ 已取消功能**
#### **小說生成功能** - **已取消** (2025-07-27)
**取消原因：** 與OkokGo邏輯差異過大，AI生成內容品質不符合實用需求
**狀態：** 已移除所有相關程式碼

### **🚫 已跳過功能**
#### **章節標記生成** - **已跳過** (與AI社群媒體YouTube頁籤功能重複)

## 🛡️ **開發規範**

### **新功能開發規則**
1. **獨立性原則** - 新功能必須獨立實作，不得修改已鎖定功能
2. **介面隔離** - 新功能的UI元件不得影響已鎖定的UI佈局
3. **程式碼隔離** - 新功能使用獨立的方法和變數，避免共用
4. **測試完整性** - 新功能完成後必須進行完整測試
5. **文件更新** - 功能完成後更新此文件的狀態

### **修改已鎖定功能的條件**
只有在以下情況下才能修改已鎖定功能：
1. **明確指令** - 使用者明確要求修改特定功能
2. **嚴重錯誤** - 發現影響系統穩定性的嚴重錯誤
3. **安全問題** - 發現安全漏洞需要修復

### **功能鎖定前的完整測試要求**
為避免類似 `prompt_text_widget` 的命名不一致問題，功能鎖定前必須：
1. **端到端測試** - 測試功能的所有使用路徑
2. **變數命名檢查** - 確保所有變數引用的一致性
3. **跨方法依賴檢查** - 確保方法間的變數引用正確
4. **錯誤處理測試** - 測試異常情況的處理
5. **UI互動測試** - 確保所有UI元件正常運作

### **程式碼審查檢查清單**
在提交任何程式碼修改前，必須檢查：
- [ ] 是否影響已鎖定功能的程式碼？
- [ ] 是否修改了已鎖定功能的UI佈局？
- [ ] 是否改變了已鎖定功能的行為？
- [ ] 新功能是否獨立且不依賴已鎖定功能的內部實作？
- [ ] 所有變數命名是否一致？
- [ ] 跨方法的變數引用是否正確？

## 📝 **變更記錄**

### **2025-07-26**
- 建立開發流程管控文件
- 鎖定語音轉錄功能 (完整測試通過)
- 鎖定AI校正功能 (完整測試通過)
- 鎖定AI分析功能 (完整測試通過)
- ✅ **完成AI翻譯功能開發** (待測試)

### **2025-07-27**
- ✅ **鎖定AI翻譯功能** (完整測試通過，UI優化完成)
- ✅ **鎖定AI新聞報導生成功能** (完整測試通過，UI一致性優化)
- ✅ **鎖定社群媒體建議功能** (完整測試通過，採用改進版一次調用方法，效率和品質顯著提升)
- ✅ **鎖定語音轉錄頁籤** (完整頁籤功能鎖定，嚴禁修改)
- ✅ **鎖定AI功能頁籤** (完整頁籤功能鎖定，按鈕排版優化完成，嚴禁修改)
- ⏸️ **暫停報導原則檢查功能開發** (法規內容完整性待確認，已移除相關程式碼)
- ❌ **取消小說生成功能** (與OkokGo邏輯差異過大，實用性不足，已移除相關程式碼)

### **2025-07-28**
- ✅ **完成圖像提示生成功能開發** (完全按照OkokGo架構，語法檢查通過，待完整功能測試)
- ✅ **鎖定圖像提示生成功能** (基於OkokGo專業架構，功能完整且符合管制開發流程)
- 🔧 **修復語音轉錄功能錯誤** (修復 prompt_text_widget 命名不一致問題，確保已鎖定功能穩定性)
- ✅ **重新確認語音轉錄頁籤鎖定狀態** (完整功能測試通過，確保所有路徑正常運作)
- ✅ **重新確認AI功能頁籤鎖定狀態** (完整功能測試通過，確保所有AI功能正常運作)

### **2025-07-30**
- 🔧 **圖像提示生成功能取消鎖定** (功能需要改善和修復，重新標記為開發改善中)
- ⚠️ **圖像提示生成功能狀態更新** (功能尚未完全穩定，需要持續改善和修復)

### **2025-08-06**
- ✅ **鎖定圖像提示生成功能** (完成即時顯示、4張一排網格佈局、一鍵下載等功能優化，UI體驗良好)
- ✅ **鎖定AI創意頁籤** (頁籤功能完整且穩定，圖像生成功能已完美整合)
- 🔧 **修改語音轉錄功能** (根據使用者明確指令進行UI介面調整、轉錄邏輯改善和錯誤修復)
  - 移除「背景線程開始執行」日誌訊息，改善使用者體驗
  - 取消「進階參數」區塊，簡化介面
  - 修改「語言與翻譯」為「音檔來源語言」下拉選單，支援中文、英文、韓文、日文
  - 移除「同時翻譯成英文」功能，因翻譯品質不佳
  - 修復WAV檔案轉錄問題，確保所有音檔都轉換為16kHz格式
  - 修正「轉換為繁體中文」名稱為「簡體轉繁體中文」
  - **UI介面重新設計** - 移除「載入SRT」功能，重新設計為更協調的佈局
    - 檔案選擇區域使用LabelFrame包裝，更清晰
    - 設定區域分為左右兩欄：轉錄設定+輸出格式 | 提示詞設定
    - 使用圖標和更好的視覺層次，提升整體協調性
    - 改善按鈕和日誌區域的視覺呈現
  - **即時轉錄進度顯示** - 修改為即時顯示Whisper輸出，讓使用者清楚了解轉錄進程
- 🔧 **AI翻譯功能改善** (根據使用者明確指令添加中文繁體翻譯選項)
  - 在翻譯語言選項中添加「Chinese (中文繁體)」
  - 調整翻譯提示詞邏輯，支援翻譯成繁體中文
  - 修復UI錯誤，移除不存在的external_srt_label引用

### **2025-08-18**
- 🚨 **緊急修復語音轉錄功能** (發現嚴重錯誤，立即修復)
  - **Whisper參數相容性修復** - 移除不支援的參數 (--patience, --length-penalty, --suppress-tokens, --condition-on-previous-text)
  - **提示詞處理修復** - 修正佔位符文字被當作實際提示詞的問題
  - **錯誤檢測改善** - 加強錯誤檢測邏輯，正確識別Whisper執行失敗
  - **Large-v3優化回退** - 移除所有Large-v3特殊參數，因為反而加劇重複問題
  - **統一參數策略** - 所有模型使用相同的標準參數，避免複雜化
  - **移除v3模型** - 完全移除Large-v3和Large-v3-Turbo選項，因為重複問題嚴重
  - **開發管制流程檢討** - 承認管制流程存在漏洞，需要加強測試覆蓋率
- ✅ **完成AI影片頁籤功能** (按照OkokGo VideoGenerationSection.tsx架構)
  - **獨立頁籤創建** - 創建完整的🎬 AI影片頁籤，與AI圖片頁籤並列
  - **完整設定介面** - 3x4網格佈局，包含API設定、風格選擇、技術參數等
  - **檔案載入功能** - 支援逐字稿檔案和起始圖片選擇
  - **提示詞生成完成** - 實作基於逐字稿的AI影片提示詞生成邏輯
  - **6層結構化提示詞** - 採用專業的影片提示詞工程架構
  - **多種配置支援** - 10種風格、3種比例、4種時長、3種人物生成策略
  - **SRT智能解析** - 自動解析SRT格式並選擇關鍵條目
  - **提示詞管理** - 編輯、刪除、複製功能完整實作
  - **影片生成框架** - 建立完整的生成流程和結果顯示
  - **狀態管理** - 完善的按鈕狀態和進度顯示

## 🎯 **下一步計劃**

### **當前開發狀態確認**

#### **🔒 已確認鎖定功能 (2025-07-28 重新驗證)**

**語音轉錄頁籤** ✅ **已重新確認鎖定**
- 修復了 `prompt_text_widget` 命名不一致問題
- 完整功能測試通過，所有轉錄路徑正常運作
- 檔案選擇、模型設定、進度顯示、輸出格式處理均正常
- 提示詞功能、語言選擇、進階參數設定均正常

**AI功能頁籤** ✅ **已重新確認鎖定**
- 所有AI功能按鈕正常運作
- AI校正、AI分析、AI翻譯、AI新聞、AI社群功能均正常
- UI佈局和按鈕排版穩定
- 狀態管理和錯誤處理機制完整

### **下一個任務：AI創意頁籤完整開發**

#### **🎯 當前任務：完善AI創意頁籤架構**
**開發目標：**
1. **完善AI創意頁籤基礎架構** - 確保頁籤佈局和基礎功能完整
2. **驗證圖像提示生成功能** - 進行完整功能測試，確保穩定性
3. **整合Veo API影片生成** - 完成實際的影片生成功能
4. **預留音樂和音訊功能擴展接口** - 為未來功能預留空間

#### **🚀 影片提示生成功能開發計劃**
**開發原則：**
- 在現有的AI創意頁籤中新增影片提示生成功能
- 完全按照OkokGo VideoGenerationSection.tsx架構
- 重用已鎖定功能的架構模式
- 不修改任何已鎖定功能的程式碼
- 使用獨立的方法和UI元件
- 採用一次調用、JSON結構化輸出的成功模式
- 完成後進行完整測試並鎖定

**實作策略：**
1. 在AI創意頁籤新增影片提示生成按鈕和UI區域
2. 實作基於逐字稿的AI影片提示詞生成 (參考OkokGo專業方法)
3. 支援多種影片風格和進階配置 (風格、比例、時長控制)
4. 建立影片提示預覽和編輯功能
5. 支援起始圖片和批次處理選項
6. 完整測試後鎖定功能

**重要特點：**
- 將逐字稿內容轉換為AI影片提示詞
- 支援多種影片風格和視覺表現
- 提供進階配置選項 (比例、時長、風格等)
- 為未來Veo API整合預留接口
- 採用與圖像提示生成相同的成功架構模式

### **目前已完成的AI功能**
1. ✅ 語音轉錄功能
2. ✅ AI校正功能
3. ✅ AI分析功能
4. ✅ AI翻譯功能
5. ✅ AI新聞報導生成功能
6. ✅ AI社群媒體建議功能
7. ✅ 圖像提示生成功能
8. ✅ AI創意頁籤

### **後續可考慮的實用AI功能建議**

#### **1. AI摘要生成功能** ⭐ **推薦**
- **實用性**：將長篇內容快速生成摘要
- **應用場景**：會議記錄、訪談整理、內容精華提取
- **技術特點**：一次調用，結構化輸出，支援不同摘要長度

#### **2. AI關鍵字提取功能** ⭐ **推薦**
- **實用性**：自動提取內容關鍵字和標籤
- **應用場景**：內容分類、搜尋優化、標籤管理
- **技術特點**：快速處理，支援重要性排序

#### **3. AI語音轉文字優化功能**
- **實用性**：針對特定領域優化轉錄準確性
- **應用場景**：專業術語、方言、特殊語境
- **技術特點**：自訂詞彙庫，上下文理解

#### **4. AI內容分類功能**
- **實用性**：自動將內容分類到不同主題
- **應用場景**：媒體庫管理、內容組織
- **技術特點**：多級分類，自訂分類體系

### **報導原則檢查功能**
**狀態：** 暫停開發，等待完整法規內容確認
**後續計劃：** 取得完整的官方自殺防治報導原則後重新實作

---

**⚠️ 重要提醒：**
此文件是開發流程的核心管控機制，任何違反鎖定原則的修改都可能導致系統不穩定。請嚴格遵守鎖定規則，確保開發品質。