# AI 分析與校正功能詳細規格說明

## 1. AI 校正功能 (ai_correct_srt)

### 使用的 AI 模型
- **模型名稱**: `gemini-1.5-pro-latest`
- **提供商**: Google Generative AI
- **模型特性**: 
  - 支援長文本處理（最多 2M tokens）
  - 多語言支援
  - 高品質的文本理解和生成能力

### 校正規則與指令

#### 核心提示詞 (Prompt)
```
請校正以下SRT字幕檔案的內容，修正語法錯誤、標點符號和用詞，但保持時間軸不變：

{srt_content}

請返回校正後的完整SRT內容。
```

#### 校正範圍
1. **語法錯誤修正**
   - 主謂賓結構調整
   - 時態一致性
   - 語序優化

2. **標點符號修正**
   - 句號、逗號、問號、驚嘆號的正確使用
   - 引號、括號的配對
   - 省略號的標準化

3. **用詞優化**
   - 同義詞替換（更準確的表達）
   - 口語轉書面語
   - 專業術語標準化

4. **保持不變的元素**
   - SRT 時間軸格式 (`00:00:01,000 --> 00:00:03,000`)
   - 字幕編號
   - 整體結構

### 處理限制
- **檔案大小**: 理論上無限制，但建議單檔不超過 10MB
- **處理時間**: 依內容長度，通常 1-30 秒
- **語言支援**: 主要針對中文，也支援英文
- **輸出格式**: 保持原 SRT 格式

### 輸出檔案命名
- **原檔案**: `example.srt`
- **校正後**: `example_corrected.srt`

---

## 2. AI 分析功能 (ai_analyze_srt)

### 使用的 AI 模型
- **模型名稱**: `gemini-1.5-pro-latest`
- **分析能力**: 內容理解、情緒分析、實體識別

### 分析項目與指令

#### 核心提示詞 (Prompt)
```
請分析以下字幕內容，提供以下資訊：

1. 內容摘要（100-200字）
2. 主要話題（3-5個）
3. 關鍵人物或實體
4. 情緒分析
5. 重要時間點或事件

字幕內容：
{text_content}

請以結構化的方式回答。
```

#### 詳細分析項目

**1. 內容摘要 (100-200字)**
- 提取核心內容
- 概括主要論點
- 保持客觀性

**2. 主要話題 (3-5個)**
- 識別討論主題
- 按重要性排序
- 提供話題關鍵字

**3. 關鍵人物或實體**
- 人名識別
- 組織機構
- 地點名稱
- 產品或服務名稱

**4. 情緒分析**
- 整體情緒傾向（正面/負面/中性）
- 情緒強度評估
- 情緒變化趨勢

**5. 重要時間點或事件**
- 關鍵決策點
- 重要宣布
- 轉折點識別

### 輸出格式
- **顯示方式**: 彈出視窗 + 文字檔案
- **檔案命名**: `example_analysis.txt`
- **結構化輸出**: 分段清晰，易於閱讀

---

## 3. 技術實作細節

### API 配置
```python
import google.generativeai as genai
genai.configure(api_key=api_key)
model = genai.GenerativeModel('gemini-1.5-pro-latest')
```

### 錯誤處理機制
1. **API 金鑰驗證**
   - 檢查金鑰是否存在
   - 驗證金鑰格式

2. **檔案存在性檢查**
   - 確認 SRT 檔案路徑
   - 檢查檔案可讀性

3. **網路連線處理**
   - 超時處理
   - 重試機制（未實作，可擴展）

4. **內容處理**
   - 編碼問題處理 (UTF-8)
   - SRT 格式解析錯誤處理

### 背景處理機制
```python
def run_ai_correction():
    # 背景執行，避免 GUI 凍結
    threading.Thread(target=run_ai_correction, daemon=True).start()
```

### 狀態管理
- `self.is_ai_correcting`: 校正進行中標記
- `self.is_ai_analyzing`: 分析進行中標記
- `update_ai_buttons_state()`: 按鈕狀態更新

---

## 4. 使用流程

### AI 校正流程
1. **準備階段**
   - 完成語音轉錄 OR 載入外部 SRT
   - 輸入 Google AI API 金鑰

2. **執行階段**
   - 點擊「AI 校正」按鈕
   - 系統讀取 SRT 內容
   - 發送到 Gemini API
   - 接收校正結果

3. **完成階段**
   - 儲存校正後檔案
   - 顯示完成訊息
   - 更新按鈕狀態

### AI 分析流程
1. **準備階段**
   - 同校正流程

2. **執行階段**
   - 點擊「AI 分析」按鈕
   - 解析 SRT 提取純文字
   - 發送分析請求
   - 處理分析結果

3. **完成階段**
   - 彈出結果視窗
   - 儲存分析報告
   - 提供儲存確認

---

## 5. 可自訂的參數 (目前固定，可擴展)

### 校正參數
- **校正強度**: 目前固定為「中等」
- **語言風格**: 目前固定為「標準中文」
- **專業領域**: 目前為「通用」

### 分析參數
- **分析深度**: 目前固定為「全面分析」
- **摘要長度**: 固定 100-200 字
- **話題數量**: 固定 3-5 個

### 建議的擴展參數
```python
# 可加入的自訂選項
correction_options = {
    "level": ["light", "medium", "deep"],
    "style": ["formal", "casual", "technical"],
    "domain": ["general", "medical", "legal", "business"]
}

analysis_options = {
    "depth": ["basic", "detailed", "comprehensive"],
    "summary_length": [50, 100, 200, 300],
    "focus": ["content", "emotion", "entities", "timeline"]
}
```

---

## 6. 效能與限制

### 處理能力
- **單次處理**: 最大 2M tokens (約 150萬中文字)
- **並發處理**: 目前不支援，一次只能處理一個檔案
- **處理速度**: 1000字約需 3-10 秒

### API 限制
- **配額限制**: 依 Google AI 帳戶等級
- **頻率限制**: 每分鐘請求次數限制
- **內容限制**: 不處理敏感內容

### 品質保證
- **準確性**: 依賴 Gemini 模型能力
- **一致性**: 同樣內容多次處理可能有細微差異
- **語言支援**: 中文效果最佳，其他語言效果可能較差

---

## 7. 故障排除

### 常見錯誤
1. **API 金鑰錯誤**
   - 檢查金鑰格式
   - 確認帳戶狀態

2. **檔案讀取錯誤**
   - 檢查檔案編碼
   - 確認檔案權限

3. **網路連線問題**
   - 檢查網路狀態
   - 確認防火牆設定

4. **內容過長**
   - 分段處理
   - 壓縮內容

### 日誌記錄
- 所有操作都會記錄在轉錄日誌區域
- 錯誤訊息會以警告形式顯示
- 成功操作會顯示檔案路徑

這份詳細規格說明涵蓋了 AI 功能的所有技術細節，你可以根據需求進行調整或擴展。